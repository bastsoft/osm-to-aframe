!function(t){var n={};function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";e.r(n);const o={r_major:6378137,r_minor:6356752.314245179,f:298.257223563,deg2rad:function(t){return t*(Math.PI/180)},rad2deg:function(t){return t/(Math.PI/180)},ll2m:function(t,n){n>89.5&&(n=89.5),n<-89.5&&(n=-89.5);const e=this.r_minor/this.r_major,o=1-e*e,r=Math.sqrt(o),i=this.deg2rad(n),a=r*Math.sin(i),u=.5*r,s=Math.pow((1-a)/(1+a),u),c=Math.tan(.5*(.5*Math.PI-i))/s;return{x:this.r_major*this.deg2rad(t),y:0-this.r_major*Math.log(c)}},m2ll:function(t,n){const e=this.r_minor/this.r_major,o=Math.sqrt(1-e*e);return{lon:this.rad2deg(t/this.r_major),lat:this.rad2deg(this.pj_phi2(Math.exp(0-n/this.r_major),o))}},pj_phi2:function(t,n){let e=15;const o=Math.PI/2,r=.5*n;let i,a=o-2*Math.atan(t);do{const e=n*Math.sin(a);a+=i=o-2*Math.atan(t*Math.pow((1-e)/(1+e),r))-a}while(Math.abs(i)>1e-10&&--e);return a}},r=function(t,n){const e=o.ll2m(t[1],t[0]);return{x:n.y-e.y,y:n.x-e.x}},i=function(t,n,e,o){return{x:(Number(t)+Number(n))/2,y:(Number(e)+Number(o))/2}},a=function(t,n,e,o){return Math.sqrt(Math.pow(t-e,2)+Math.pow(n-o,2))},u=function(t,n,e){const o=n.X-t.X,r=t.Y-n.Y,i=e.X-t.X,a=t.Y-e.Y,u=180*Math.atan2(o,r)/Math.PI;return 180*Math.atan2(i,a)/Math.PI-u},s=function(t,n,e={}){const o=Object.assign({},t.tag||{},e),r=[],s=t.nd,l=Number(o["building:levels"])||1,h=Number(o["building:min_level"])||0,m=Number(o.height)||4*l,d=Number(o.min_height)||4*h;let y=null;const f=[];return Object.keys(s).forEach(function(t){const e=s[t].ref,o=n.node[e].point;if(y){f.push([o.x,o.y].join(" "));const t=a(o.x,o.y,y.x,y.y),n=i(o.x,y.x,o.y,y.y),e=u({X:n.x,Y:n.y},{X:Number(y.x),Y:Number(y.y)},{X:Number(n.x+t/2),Y:Number(n.y)}),s=t/12,c=[n.x,m/2+d,n.y].join(" ");r.push(["a-plane",{position:c,rotation:"0 "+e+" 0",width:t,height:m,color:"orange",material:"src: #window1; repeat: "+s+" "+l+"; side: double"}])}y=o}),c(r,f,m,d),["a-entity",{},r]},c=function(t,n,e,o){n.length>2&&(t.push(["a-entity",{geometry:"primitive: buildingCover; vertices: "+n.join(", ")+"; height: "+(e+o),material:"side:double"}]),0!==o&&t.push(["a-entity",{geometry:"primitive: buildingCover; vertices: "+n.join(", ")+"; height: "+o,material:"side:double"}]))},l=function(t,n){const e=[],o=Array.isArray(t.member)?t.member:[t.member];return h(o,n,t.tag,e),["a-entity",{},e]},h=function(t,n,e,o){t.forEach(function(t){Array.isArray(t)?h(t,n,e,o):m(t,n,e,o)})},m=function(t,n,e,o){"way"===t.type&&n.way[Number(t.ref)]&&o.push(s(n.way[Number(t.ref)],n,e)),"relation"===t.type&&Boolean(n.relation[t.ref])&&(console.log("YES"),o.push(l(n.relation[t.ref],n)))};var d=function(t,n){const e=[],o=t.nd;let r=null;return Object.keys(o).forEach(function(s){const c=o[s].ref,l=n.node[c].point;if(r){const n=a(l.x,l.y,r.x,r.y),o=i(l.x,r.x,l.y,r.y),s=u({X:o.x,Y:o.y},{X:Number(r.x),Y:Number(r.y)},{X:Number(o.x+n/2),Y:Number(o.y)});let c=1,h="red",m=.01;"footway"===t.tag.highway&&(c=4,h="orange",m=.02),"service"===t.tag.highway&&(c=8,h="gray",m=.03),"residential"===t.tag.highway&&(c=10,h="silver",m=.04),"secondary"===t.tag.highway&&(c=12,h="gainsboro",m=.05),"red"===h&&console.log(t.tag.highway),e.push(["a-plane",{position:[o.x,m,o.y].join(" "),rotation:"-90 "+s+" 0",width:n,height:c,color:h}])}r=l}),["a-entity",{},e]};const y=function(t){const n=[];return Object.keys(t.way).forEach(function(e){let o=t.way[e];const r=o.tag||{};r.building&&(n.push(function(t,n){return s(t,n)}(o,t)),o=null),r.highway&&(n.push(d(o,t)),o=null)}),["a-entity",{class:"way"},n]};var f=function(t){return["a-entity",{position:[0,1.8,0].join(" "),camera:"userHeight: 1.8",id:"mainUser","look-controls":"","mouse-cursor":"","mwasd-controls":{acceleration:300}},[["a-entity",{cursor:"fuse: true; fuseTimeout: 500",position:"0 0 -1",geometry:"primitive: ring; radiusInner: 0.02; radiusOuter: 0.03",material:"color: black; shader: flat"}],["a-entity",{id:"debugText",text:"value:Ne ponimaet\ntranslate\npoetomu tak ; color: red; width: 1;",position:"0 0 -1"}]]]};const p=function(t,n){const e=function(t){const n=t[0],o=t[1],r=t[2],i=document.createElement(n);return Object.keys(o||{}).forEach(function(t){i.setAttribute(t,o[t])}),(r||[]).forEach(function(t){i.appendChild(e(t))}),i},o=["a-entity",{},[["a-sky",{src:"#sky"}],f(t),function(){const n=t.minPointBounds,e=t.maxPointBounds,o=a(n.x,n.y,e.x,n.y),r=a(n.x,n.y,n.x,e.y);return["a-plane",{position:[t.midPointBounds.x,0,t.midPointBounds.y],rotation:"-90 0 0",width:r,height:o,color:"#7BC8A4"}]}(),y(t),function(t){const n=[];return Object.keys(t.relation).forEach(function(e){let o=t.relation[e];const r=o.tag||{};(r.building||"building"===r.type)&&(n.push(l(o,t)),o=null)}),["a-entity",{class:"relation"},n]}(t)]];n.appendChild(e(o))},b=function(t,n,e){var a,u;g(t,n,e).then(a=>{a.minPointBounds=o.ll2m(a.bounds[0][1],a.bounds[0][0]),a.maxPointBounds=o.ll2m(a.bounds[1][1],a.bounds[1][0]),a.midPointBounds=i(a.maxPointBounds.x,a.minPointBounds.x,a.maxPointBounds.y,a.minPointBounds.y);const s=o.ll2m(n,t);return a.freeMoveArea=[[s.x-e/2,s.y-e/2],[s.x-e/2,s.y-e/2]],u=(a=a).midPointBounds,Object.keys(a.node||{}).forEach(t=>{const n=a.node[t];n.LatLng&&(n.point=r(n.LatLng,u))}),a}).then(t=>p(t,document.querySelector("a-scene")))},g=function(t,n,e){let o=null;const r={"55.15556-61.40892-200":"stub/data.json","55.75547233180139-37.618315787003674-200":"stub/dataMoscowRedSquare.json"},i=t+"-"+n+"-"+e;return(o=r[i]?fetch(r[i]):x(t,n,e)).then(t=>t.json())},x=function(t,n,e){const r=function(t,n,e){e=Number(e);const r=o.ll2m(t,n),i=o.m2ll(r.x-e,r.y-e),a=o.m2ll(r.x+e,r.y+e);return{leftLon:i.lon,bottomLat:i.lat,rightLon:a.lon,topLat:a.lat}}(n,t,e);return fetch("https://blooming-beach-75686.herokuapp.com/api/0.6/map?bbox="+[r.leftLon,r.bottomLat,r.rightLon,r.topLat].join(","),{mode:"cors"})},j=(window.location.href.split("?")[1]||"").split("&");let w=null,M=null,N=null;j.length>2&&(w=j[0].split("=")[1],M=j[1].split("=")[1],N=j[2].split("=")[1].replace("#","")),w&&M&&N?b(Number(w),Number(M),Number(N)):b(55.15556,61.40892,200)}]);