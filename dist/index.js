!function(t){var n={};function o(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=n,o.d=function(t,n,e){o.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:e})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(n,"a",n),n},o.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},o.p="",o(o.s=0)}([function(t,n,o){"use strict";o.r(n);const e=function(t,n,o,e){return{x:(Number(t)+Number(n))/2,y:(Number(o)+Number(e))/2}},r=function(t,n,o,e){return Math.sqrt(Math.pow(t-o,2)+Math.pow(n-e,2))},i=function(t,n,o){const e=n.X-t.X,r=t.Y-n.Y,i=o.X-t.X,a=t.Y-o.Y,u=180*Math.atan2(e,r)/Math.PI;return 180*Math.atan2(i,a)/Math.PI-u},a={r_major:6378137,r_minor:6356752.314245179,f:298.257223563,deg2rad:function(t){return t*(Math.PI/180)},rad2deg:function(t){return t/(Math.PI/180)},ll2m:function(t,n){n>89.5&&(n=89.5),n<-89.5&&(n=-89.5);const o=this.r_minor/this.r_major,e=1-o*o,r=Math.sqrt(e),i=this.deg2rad(n),a=r*Math.sin(i),u=.5*r,s=Math.pow((1-a)/(1+a),u),l=Math.tan(.5*(.5*Math.PI-i))/s;return{x:this.r_major*this.deg2rad(t),y:0-this.r_major*Math.log(l)}},m2ll:function(t,n){const o=this.r_minor/this.r_major,e=Math.sqrt(1-o*o);return{lon:this.rad2deg(t/this.r_major),lat:this.rad2deg(this.pj_phi2(Math.exp(0-n/this.r_major),e))}},pj_phi2:function(t,n){let o=15;const e=Math.PI/2,r=.5*n;let i,a=e-2*Math.atan(t);do{const o=n*Math.sin(a);a+=i=e-2*Math.atan(t*Math.pow((1-o)/(1+o),r))-a}while(Math.abs(i)>1e-10&&--o);return a}},u=function(t,n){const o=a.ll2m(t[1],t[0]);return{x:n.y-o.y,y:n.x-o.x}};var s=function(t,n){const o=[],a=t.nd,u=Number(t.tag["building:levels"])||1,s=Number(t.tag["building:min_level"])||0,l=4*u,c=4*s;let h=null;const d=[];return Object.keys(a).forEach(function(t){const s=a[t].ref,m=n.node[s].point;if(h){d.push([m.x,m.y].join(" "));const t=r(m.x,m.y,h.x,h.y),n=e(m.x,h.x,m.y,h.y),a=i({X:n.x,Y:n.y},{X:Number(h.x),Y:Number(h.y)},{X:Number(n.x+t/2),Y:Number(n.y)}),s=t/12,p=[n.x,l/2+c,n.y].join(" ");o.push(["a-plane",{position:p,rotation:"0 "+a+" 0",width:t,height:l,color:"orange",material:"src: #window1; repeat: "+s+" "+u+"; side: double"}])}h=m}),o.push(["a-entity",{geometry:"primitive: buildingCover; vertices: "+d.join(", ")+"; height: "+(l+c),material:"side:double"}]),0!==c&&o.push(["a-entity",{geometry:"primitive: buildingCover; vertices: "+d.join(", ")+"; height: "+c,material:"side:double"}]),["a-entity",{},o]};var l=function(t,n){const o=[],a=t.nd;let u=null;return Object.keys(a).forEach(function(s){const l=a[s].ref,c=n.node[l].point;if(u){const n=r(c.x,c.y,u.x,u.y),a=e(c.x,u.x,c.y,u.y),s=i({X:a.x,Y:a.y},{X:Number(u.x),Y:Number(u.y)},{X:Number(a.x+n/2),Y:Number(a.y)});let l=1,h="red",d=.01;"footway"===t.tag.highway&&(l=4,h="orange",d=.02),"service"===t.tag.highway&&(l=8,h="gray",d=.03),"residential"===t.tag.highway&&(l=10,h="silver",d=.04),"secondary"===t.tag.highway&&(l=12,h="gainsboro",d=.05),"red"===h&&console.log(t.tag.highway),o.push(["a-plane",{position:[a.x,d,a.y].join(" "),rotation:"-90 "+s+" 0",width:n,height:l,color:h}])}u=c}),["a-entity",{},o]};var c=function(t){const n=[];return Object.keys(t.way).forEach(function(o){let e=t.way[o];const r=e.tag||{};e.tag||console.log("not Tag: ",e),r.building&&(n.push(s(e,t)),e=null),r.highway&&(n.push(l(e,t)),e=null)}),["a-entity",{},n]};var h=function(t){return["a-entity",{position:[0,1.8,0].join(" "),camera:"userHeight: 1.8",id:"mainUser","look-controls":"","mouse-cursor":"","mwasd-controls":{acceleration:300}},[["a-entity",{cursor:"fuse: true; fuseTimeout: 500",position:"0 0 -1",geometry:"primitive: ring; radiusInner: 0.02; radiusOuter: 0.03",material:"color: black; shader: flat"}],["a-entity",{id:"debugText",text:"value:Ne ponimaet\ntranslate\npoetomu tak ; color: red; width: 1;",position:"0 0 -1"}]]]};const d=function(t,n,o){m(t,n,o).then(t=>(function(t,n){const o=function(t){const n=t[0],e=t[1],r=t[2],i=document.createElement(n);return Object.keys(e||{}).forEach(function(t){i.setAttribute(t,e[t])}),(r||[]).forEach(function(t){i.appendChild(o(t))}),i},e=["a-entity",{},[["a-sky",{src:"#sky"}],h(t),function(){const n=t.minPointBounds,o=t.maxPointBounds,e=r(n.x,n.y,o.x,n.y),i=r(n.x,n.y,n.x,o.y);return["a-plane",{position:[t.midpointBounds.x,0,t.midpointBounds.y],rotation:"-90 0 0",width:i,height:e,color:"#7BC8A4"}]}(),c(t)]];n.appendChild(o(e))})(t,document.querySelector("a-scene")))},m=function(t,n,o){let r=null;return(r=55.15556===t&&61.40892===n&&200===o?fetch("stub/data.json"):p(t,n,o)).then(t=>t.json()).then(t=>(i=t,i.minPointBounds=a.ll2m(i.bounds[0][1],i.bounds[0][0]),i.maxPointBounds=a.ll2m(i.bounds[1][1],i.bounds[1][0]),i.midpointBounds=e(i.maxPointBounds.x,i.minPointBounds.x,i.maxPointBounds.y,i.minPointBounds.y),Object.keys(i.node||{}).forEach(t=>{const n=i.node[t];n.LatLng&&(n.point=u(n.LatLng,i.midpointBounds))}),i));var i},p=function(t,n,o){const e=function(t,n,o){o=Number(o);const e=a.ll2m(t,n),r=a.m2ll(e.x-o,e.y-o),i=a.m2ll(e.x+o,e.y+o);return{leftLon:r.lon,bottomLat:r.lat,rightLon:i.lon,topLat:i.lat}}(n,t,o);return fetch("https://blooming-beach-75686.herokuapp.com/api/0.6/map?bbox="+[e.leftLon,e.bottomLat,e.rightLon,e.topLat].join(","),{mode:"cors"})},y=(window.location.href.split("?")[1]||"").split("&");let f=null,g=null,b=null;y.length>2&&(f=y[0].split("=")[1],g=y[1].split("=")[1],b=y[2].split("=")[1].replace("#","")),f&&g&&b?d(Number(f),Number(g),Number(b)):d(55.15556,61.40892,200)}]);