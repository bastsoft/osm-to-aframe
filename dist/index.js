!function(t){var n={};function o(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=n,o.d=function(t,n,e){o.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:e})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(n,"a",n),n},o.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},o.p="",o(o.s=0)}([function(t,n,o){"use strict";o.r(n);const e={r_major:6378137,r_minor:6356752.314245179,f:298.257223563,deg2rad:function(t){return t*(Math.PI/180)},rad2deg:function(t){return t/(Math.PI/180)},ll2m:function(t,n){n>89.5&&(n=89.5),n<-89.5&&(n=-89.5);const o=this.r_minor/this.r_major,e=1-o*o,r=Math.sqrt(e),i=this.deg2rad(n),a=r*Math.sin(i),u=.5*r,s=Math.pow((1-a)/(1+a),u),c=Math.tan(.5*(.5*Math.PI-i))/s;return{x:this.r_major*this.deg2rad(t),y:0-this.r_major*Math.log(c)}},m2ll:function(t,n){const o=this.r_minor/this.r_major,e=Math.sqrt(1-o*o);return{lon:this.rad2deg(t/this.r_major),lat:this.rad2deg(this.pj_phi2(Math.exp(0-n/this.r_major),e))}},pj_phi2:function(t,n){let o=15;const e=Math.PI/2,r=.5*n;let i,a=e-2*Math.atan(t);do{const o=n*Math.sin(a);a+=i=e-2*Math.atan(t*Math.pow((1-o)/(1+o),r))-a}while(Math.abs(i)>1e-10&&--o);return a}},r=function(t,n){const o=e.ll2m(t[1],t[0]);return{x:n.y-o.y,y:n.x-o.x}},i=function(t,n,o,e){return{x:(Number(t)+Number(n))/2,y:(Number(o)+Number(e))/2}},a=function(t,n,o,e){return Math.sqrt(Math.pow(t-o,2)+Math.pow(n-e,2))},u=function(t,n,o){const e=n.X-t.X,r=t.Y-n.Y,i=o.X-t.X,a=t.Y-o.Y,u=180*Math.atan2(e,r)/Math.PI;return 180*Math.atan2(i,a)/Math.PI-u},s=function(t,n,o={}){const e=Object.assign({},t.tag||{},o),r=[],s=t.nd,l=Number(e["building:levels"])||1,h=Number(e["building:min_level"])||0,m=Number(e.height)||4*l,d=Number(e.min_height)||4*h;let y=null;const f=[];return Object.keys(s).forEach(function(t){const o=s[t].ref,e=n.node[o].point;if(y){f.push([e.x,e.y].join(" "));const t=a(e.x,e.y,y.x,y.y),n=i(e.x,y.x,e.y,y.y),o=u({X:n.x,Y:n.y},{X:Number(y.x),Y:Number(y.y)},{X:Number(n.x+t/2),Y:Number(n.y)}),s=t/12,c=[n.x,m/2+d,n.y].join(" ");r.push(["a-plane",{position:c,rotation:"0 "+o+" 0",width:t,height:m,color:"orange",material:"src: #window1; repeat: "+s+" "+l+"; side: double"}])}y=e}),c(r,f,m,d),["a-entity",{},r]},c=function(t,n,o,e){n.length>2&&(t.push(["a-entity",{geometry:"primitive: buildingCover; vertices: "+n.join(", ")+"; height: "+(o+e),material:"color:orange; side:double"}]),0!==e&&t.push(["a-entity",{geometry:"primitive: buildingCover; vertices: "+n.join(", ")+"; height: "+e,material:"color:orange; side:double"}]))},l=function(t,n){const o=[],e=Array.isArray(t.member)?t.member:[t.member];return h(e,n,t.tag,o),["a-entity",{},o]},h=function(t,n,o,e){t.forEach(function(t){Array.isArray(t)?h(t,n,o,e):m(t,n,o,e)})},m=function(t,n,o,e){"way"===t.type&&n.way[Number(t.ref)]&&e.push(s(n.way[Number(t.ref)],n,o)),"relation"===t.type&&Boolean(n.relation[t.ref])&&(console.log("YES"),e.push(l(n.relation[t.ref],n)))};var d=function(t,n){const o=[],e=t.nd;let r=null;return Object.keys(e).forEach(function(s){const c=e[s].ref,l=n.node[c].point;if(r){const n=a(l.x,l.y,r.x,r.y),e=i(l.x,r.x,l.y,r.y),s=u({X:e.x,Y:e.y},{X:Number(r.x),Y:Number(r.y)},{X:Number(e.x+n/2),Y:Number(e.y)});let c=1,h="red",m=.01;"footway"===t.tag.highway&&(c=4,h="orange",m=.02),"service"===t.tag.highway&&(c=8,h="gray",m=.03),"residential"===t.tag.highway&&(c=10,h="silver",m=.04),"secondary"===t.tag.highway&&(c=12,h="gainsboro",m=.05),"red"===h&&console.log(t.tag.highway),o.push(["a-plane",{position:[e.x,m,e.y].join(" "),rotation:"-90 "+s+" 0",width:n,height:c,color:h}])}r=l}),["a-entity",{},o]};const y=function(t){const n=[];return Object.keys(t.way).forEach(function(o){let e=t.way[o];const r=e.tag||{};r.building&&(n.push(function(t,n){return s(t,n)}(e,t)),e=null),r.highway&&(n.push(d(e,t)),e=null)}),["a-entity",{class:"way"},n]};var f=function(t){return["a-entity",{position:[0,1.8,0].join(" "),camera:"userHeight: 1.8",id:"mainUser","look-controls":"","mouse-cursor":"","mwasd-controls":{acceleration:300}},[["a-entity",{cursor:"fuse: true; fuseTimeout: 500",position:"0 0 -1",geometry:"primitive: ring; radiusInner: 0.02; radiusOuter: 0.03",material:"color: black; shader: flat"}],["a-entity",{id:"debugText",text:"value:Ne ponimaet\ntranslate\npoetomu tak ; color: red; width: 1;",position:"0 0 -1"}]]]};const p=function(t,n){const o=function(t){const n=t[0],e=t[1],r=t[2],i=document.createElement(n);return Object.keys(e||{}).forEach(function(t){i.setAttribute(t,e[t])}),(r||[]).forEach(function(t){i.appendChild(o(t))}),i},e=["a-entity",{},[["a-sky",{src:"#sky"}],f(t),function(){const n=t.minPointBounds,o=t.maxPointBounds,e=a(n.x,n.y,o.x,n.y),r=a(n.x,n.y,n.x,o.y);return["a-plane",{position:[t.midPointBounds.x,0,t.midPointBounds.y],rotation:"-90 0 0",width:r,height:e,color:"#7BC8A4"}]}(),y(t),function(t){const n=[];return Object.keys(t.relation).forEach(function(o){let e=t.relation[o];const r=e.tag||{};(r.building||"building"===r.type)&&(n.push(l(e,t)),e=null)}),["a-entity",{class:"relation"},n]}(t)]];n.appendChild(o(e))},b=function(t,n,o){var a,u;g(t,n,o).then(a=>{a.minPointBounds=e.ll2m(a.bounds[0][1],a.bounds[0][0]),a.maxPointBounds=e.ll2m(a.bounds[1][1],a.bounds[1][0]),a.midPointBounds=i(a.maxPointBounds.x,a.minPointBounds.x,a.maxPointBounds.y,a.minPointBounds.y);const s=e.ll2m(n,t);return a.freeMoveArea=[[s.x-o/2,s.y-o/2],[s.x-o/2,s.y-o/2]],u=(a=a).midPointBounds,Object.keys(a.node||{}).forEach(t=>{const n=a.node[t];n.LatLng&&(n.point=r(n.LatLng,u))}),a}).then(t=>p(t,document.querySelector("a-scene")))},g=function(t,n,o){let e=null;const r={"55.15556-61.40892-200":"stub/data.json","55.75547233180139-37.618315787003674-200":"stub/dataMoscowRedSquare.json"},i=t+"-"+n+"-"+o;return(e=r[i]?fetch(r[i]):x(t,n,o)).then(t=>t.json())},x=function(t,n,o){const r=function(t,n,o){o=Number(o);const r=e.ll2m(t,n),i=e.m2ll(r.x-o,r.y-o),a=e.m2ll(r.x+o,r.y+o);return{leftLon:i.lon,bottomLat:i.lat,rightLon:a.lon,topLat:a.lat}}(n,t,o);return fetch("https://blooming-beach-75686.herokuapp.com/api/0.6/map?bbox="+[r.leftLon,r.bottomLat,r.rightLon,r.topLat].join(","),{mode:"cors"})},j=(window.location.href.split("?")[1]||"").split("&");let w=null,M=null,N=null;j.length>2&&(w=j[0].split("=")[1],M=j[1].split("=")[1],N=j[2].split("=")[1].replace("#","")),w&&M&&N?b(Number(w),Number(M),Number(N)):b(55.15556,61.40892,200)}]);